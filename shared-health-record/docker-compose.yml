version: '3.9'

services:
  shared-health-record:
    image: ghcr.io/i-tech-uw/shared-health-record:latest
    networks:
      - default
      - hapi-fhir
      - shr
      - kafka
      - opencr
    configs:
      - source: shr_config
        target: /app/config/config_docker.json
      - source: shr_mediator
        target: /app/config/mediator_docker.json
    deploy:
      restart_policy:
        condition: any
        delay: 5s
      resources:
        limits:
          cpus: '1'
          memory: 2G
        reservations:
          cpus: '.5'
          memory: 1G
configs:
  shr_config:
    file: ./config/config.json
    labels:
      name: shr
  shr_mediator:
    file: ./config/mediator.json
    labels:
      name: shr

networks:
  default:
  kafka:
    external: true
    name: kafka_public
  hapi-fhir:
    external: true
    name: hapi-fhir_public
  shr:
    name: shr_public
    external: true
  opencr:
    name: opencr
    external: true
  default:
